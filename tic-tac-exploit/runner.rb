require_relative './octokitClient'
require 'yaml'

module TicTacExploit
    class Runner
        METADATA_FILE_PATH = 'tic-tac-exploit/metadata.yml'
        README_PATH = 'README.md'

        def initialize(
            github_token:,
            issue_number:,
            issue_title:,
            repository:,
            user:,
            development: true
          )
          @github_token = github_token
          @repository = repository
          @issue_number = issue_number
          @issue_title = issue_title
          @user = user
          @development = development
          @playerdata 
        end


        def run
            commanddata = ''
            if @issue_title.start_with?('ttestate:')
                command = 'newstate'
                commanddata << @issue_title
                commanddata['ttestate:']='' 
            end
            @playerdata = commanddata.split('|')

            if didUseTooManyPoints
                octokit.comment("So you figured it out. You can edit the issue title ;-) However this should not be too easy for you.
                You can only use three datapoints")
                octokit.add_reaction(reaction: 'hooray')
                octokit.add_reaction(reaction: 'laugh')
            end 
            acknowledge_issue

        end

        def didUseTooManyPoints?
            for i in @playerdata do
                if i=1
                    points +=1
                end
            end
            if points > 3
                return true
            else
                return false
            end
        end

        def acknowledge_issue
            octokit.add_label(label: 'tic-tac')
            octokit.add_reaction(reaction: 'eyes')
            octokit.close_issue
        end

        def octokit
            @octokit ||= OctokitClient.new(github_token: @github_token, repository: @repository, issue_number: @issue_number)
        end
    end
end