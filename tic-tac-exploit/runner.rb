require_relative './octokitClient'
require 'yaml'

module TicTacExploit
    class Runner
        METADATA_FILE_PATH = 'tic-tac-exploit/metadata.yml'
        README_PATH = 'README.md'

        def initialize(
            github_token:,
            issue_number:,
            issue_title:,
            repository:,
            user:,
            development: true
          )
          @github_token = github_token
          @repository = repository
          @issue_number = issue_number
          @issue_title = issue_title
          @user = user
          @development = development
        end


        def run
            commanddata = ''
            if @issue_title.start_with?('ttestate:')
                command = 'newstate'
                commanddata << @issue_title
                commanddata['ttestate:']='' 
            end
            split_input = commanddata.split('|')
            acknowledge_issue

        end

        def acknowledge_issue
            octokit.add_label(label: 'tic-tac')
            octokit.add_reaction(reaction: 'eyes')
            octokit.close_issue
        end

        def octokit
            @octokit ||= OctokitClient.new(github_token: @github_token, repository: @repository, issue_number: @issue_number)
        end
    end
end